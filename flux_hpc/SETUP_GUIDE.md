# FLUX HPC - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å FLUX –Ω–∞ HPC –∫–ª–∞—Å—Ç–µ—Ä–µ –ë–ï–ó –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –¢–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–Ω–∏–∫–∞–∫–æ–≥–æ GPT 4o)
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç) ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (HPC –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- ‚úÖ SLURM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è HPC
- ‚úÖ 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ë–ï–ó –ø–æ–¥—Å–∫–∞–∑–æ–∫ + 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –° –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç
- ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ seeds)
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
flux_hpc/
‚îú‚îÄ‚îÄ 01_download_models.py          # –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∑–æ–Ω–∞)
‚îú‚îÄ‚îÄ 02_generate_images.py          # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (HPC)
‚îú‚îÄ‚îÄ utils.py                       # –£—Ç–∏–ª–∏—Ç—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ script.sbatch                  # SLURM —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ download_models.sbatch         # SLURM —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ setup_directories.sh           # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ prompts.json                   # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
‚îú‚îÄ‚îÄ requirements.txt               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ README.md                      # –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îî‚îÄ‚îÄ SETUP_GUIDE.md                 # –≠—Ç–∞ —Ñ–∞–π–ª
```

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–ê–ì 1Ô∏è‚É£: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

#### 1.1 –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/SAP/flux_hpc

# –°–æ–∑–¥–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è Python 3.10+)
conda create -n flux_env python=3.10
conda activate flux_env

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

#### 1.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python3 utils.py --check-env
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
============================================================
  Python –≤–µ—Ä—Å–∏—è......................... 2.1.2
  PyTorch —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.................... ‚úÖ
  CUDA –¥–æ—Å—Ç—É–ø–Ω–∞......................... ‚úÖ
  CUDA –≤–µ—Ä—Å–∏—è........................... 12.1
  –î–æ—Å—Ç—É–ø–Ω—ã–µ GPU......................... 1
  –¢–µ–∫—É—â–∏–π GPU........................... NVIDIA A100-PCIE-40GB
```

---

### –®–ê–ì 2Ô∏è‚É£: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π (–û–î–ò–ù –†–ê–ó!)

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –≠—Ç–æ—Ç —à–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó! –ú–æ–¥–µ–ª—å 25GB, —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞!

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ —Å GPU

```bash
# –ò–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ flux_hpc
python3 01_download_models.py --output_dir ./models

# –ó–∞–π–º–µ—Ç 10-20 –º–∏–Ω—É—Ç
# –ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ ./models/flux_dev/
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ù–∞ HPC –∫–ª–∞—Å—Ç–µ—Ä–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π –∑–æ–Ω–µ)

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å download_models.sbatch, —É–∫–∞–∑–∞–≤ –ø–æ–ª–Ω—ã–µ –ø—É—Ç–∏:
# - cd /path/to/SAP/flux_hpc  (–ü–û–õ–ù–´–ô –ø—É—Ç—å)
# - --output_dir /path/to/models  (–ü–û–õ–ù–´–ô –ø—É—Ç—å)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
sbatch download_models.sbatch

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
squeue -u $USER
tail -f runs/download-XXXX.log
```

**–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:**
```
models/
‚îî‚îÄ‚îÄ flux_dev/
    ‚îú‚îÄ‚îÄ vae_decoder/
    ‚îú‚îÄ‚îÄ text_encoder_2/
    ‚îú‚îÄ‚îÄ transformer/
    ‚îú‚îÄ‚îÄ config.json
    ‚îî‚îÄ‚îÄ ...
```

---

### –®–ê–ì 3Ô∏è‚É£: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

#### 3.1 –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω

```bash
python3 utils.py --create-template my_prompts.json
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª `my_prompts.json` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏.

#### 3.2 –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å prompts.json

–§–æ—Ä–º–∞—Ç JSON:
```json
{
  "prompt_name_1": {
    "text": "–ì–õ–ê–í–ù–´–ô –ü–†–û–ú–ü–¢ –î–õ–Ø –ë–ê–ó–û–í–û–ô –ì–ï–ù–ï–†–ê–¶–ò–ò",
    "hints": [
      "–ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å—Ç–∏–ª—è 1",
      "–ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å—Ç–∏–ª—è 2",
      "–ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å—Ç–∏–ª—è 3",
      "–ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å—Ç–∏–ª—è 4",
      "–ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å—Ç–∏–ª—è 5"
    ]
  },
  "prompt_name_2": {
    "text": "–í–¢–û–†–û–ô –ì–õ–ê–í–ù–´–ô –ü–†–û–ú–ü–¢",
    "hints": [
      "–ø–æ–¥—Å–∫–∞–∑–∫–∞ 1",
      ...
    ]
  }
}
```

#### 3.3 –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª

```bash
python3 utils.py --validate-prompts my_prompts.json
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìã –í–∞–ª–∏–¥–∞—Ü–∏—è: my_prompts.json
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ JSON —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  –í—Å–µ–≥–æ –ø—Ä–æ–º–ø—Ç–æ–≤: 3
  –í—Å–µ–≥–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫: 15
  –ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 21

‚úÖ –§–∞–π–ª –ø—Ä–æ–º–ø—Ç–æ–≤ –≤–∞–ª–∏–¥–µ–Ω!
```

---

### –®–ê–ì 4Ô∏è‚É£: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ HPC –∫–ª–∞—Å—Ç–µ—Ä

```bash
# –° –≤–∞—à–µ–π –º–∞—à–∏–Ω—ã:
scp -r models/ username@hpc.cluster:/path/to/project/flux_hpc/
scp prompts.json username@hpc.cluster:/path/to/project/flux_hpc/
scp 02_generate_images.py username@hpc.cluster:/path/to/project/flux_hpc/
scp script.sbatch username@hpc.cluster:/path/to/project/flux_hpc/
scp setup_directories.sh username@hpc.cluster:/path/to/project/flux_hpc/
```

–ò–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é:
```bash
scp -r flux_hpc/ username@hpc.cluster:/path/to/project/
```

---

### –®–ê–ì 5Ô∏è‚É£: –ó–∞–ø—É—Å–∫ –Ω–∞ HPC

#### 5.1 –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ HPC

```bash
ssh username@hpc.cluster
```

#### 5.2 –°–æ–∑–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

```bash
cd /path/to/project/flux_hpc
bash setup_directories.sh
```

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
```
‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã:
   üìÇ runs/ - –¥–ª—è –ª–æ–≥–æ–≤ –∏ –æ—à–∏–±–æ–∫
   üìÇ results/ - –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   üìÇ models/ - –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
```

#### 5.3 –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å script.sbatch

–ó–∞–º–µ–Ω–∏—Ç—å –ø—É—Ç–∏ –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ:

```bash
# –ë–´–õ–û:
cd /path/to/SAP/flux_hpc
python3 02_generate_images.py \
    --model_path /path/to/models/flux_dev \

# –°–¢–ê–õ–û (–ø—Ä–∏–º–µ—Ä):
cd /home/username/project/flux_hpc
python3 02_generate_images.py \
    --model_path /home/username/project/flux_hpc/models/flux_dev \
```

#### 5.4 –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ

```bash
sbatch script.sbatch

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
squeue -u $USER

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
tail -f runs/flux-XXXXXX.log

# –ö–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –≤ results/
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

```
results/
‚îú‚îÄ‚îÄ prompt_name_1/
‚îÇ   ‚îú‚îÄ‚îÄ without_hints/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ img_0000.png    ‚Üê –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1 –ë–ï–ó –ø–æ–¥—Å–∫–∞–∑–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img_0001.png    ‚Üê –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2 –ë–ï–ó –ø–æ–¥—Å–∫–∞–∑–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ with_hints/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ img_hint_0000.png  ‚Üê –° –ø–æ–¥—Å–∫–∞–∑–∫–æ–π 1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ img_hint_0001.png  ‚Üê –° –ø–æ–¥—Å–∫–∞–∑–∫–æ–π 2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ img_hint_0002.png  ‚Üê –° –ø–æ–¥—Å–∫–∞–∑–∫–æ–π 3
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ img_hint_0003.png  ‚Üê –° –ø–æ–¥—Å–∫–∞–∑–∫–æ–π 4
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img_hint_0004.png  ‚Üê –° –ø–æ–¥—Å–∫–∞–∑–∫–æ–π 5
‚îÇ   ‚îî‚îÄ‚îÄ metadata.json       ‚Üê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–º–ø—Ç–µ –∏ seed'–∞—Ö
‚îú‚îÄ‚îÄ prompt_name_2/
‚îÇ   ‚îî‚îÄ‚îÄ ...
```

–ö–∞–∂–¥—ã–π `metadata.json`:
```json
{
  "prompt": "A serene landscape with mountains at sunset...",
  "hints": ["–ø–æ–¥—Å–∫–∞–∑–∫–∞ 1", "–ø–æ–¥—Å–∫–∞–∑–∫–∞ 2", ...],
  "images_without_hints": 2,
  "images_with_hints": 5,
  "seeds_without_hints": [42, 43],
  "seeds_with_hints": [44, 45, 46, 47, 48]
}
```

---

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ script.sbatch

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|---------|
| `--model_path` | `/path/to/models/flux_dev` | –ü—É—Ç—å –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ |
| `--prompts_file` | `./prompts.json` | JSON —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏ |
| `--output_dir` | `./results` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| `--num_without_hints` | `2` | –ö–æ–ª-–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ |
| `--num_with_hints` | `5` | –ö–æ–ª-–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ |
| `--height` | `1024` | –í—ã—Å–æ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| `--width` | `1024` | –®–∏—Ä–∏–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| `--seed_base` | `42` | –ù–∞—á–∞–ª—å–Ω—ã–π seed |

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SLURM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –î–ª—è V100 (type_a, type_b, type_c):

```bash
#SBATCH --gpus=1
#SBATCH --cpus-per-task=8
#SBATCH --time=2:00:00
#SBATCH --constraint="[type_a|type_b|type_c]"
```

### –î–ª—è A100 (type_e):

```bash
#SBATCH --gpus=1
#SBATCH --cpus-per-task=16
#SBATCH --time=1:00:00
#SBATCH --constraint="type_e"
```

### –î–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–º–ø—Ç–æ–≤):

```bash
#SBATCH --job-name=flux_batch
#SBATCH --array=1-5%2        # 5 –∑–∞–¥–∞–Ω–∏–π, –º–∞–∫—Å–∏–º—É–º 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
#SBATCH --time=1:00:00
```

---

## ‚è±Ô∏è –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–î–ª—è –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- V100: 15-30 —Å–µ–∫—É–Ω–¥ (50 —à–∞–≥–æ–≤)
- A100: 5-10 —Å–µ–∫—É–Ω–¥ (50 —à–∞–≥–æ–≤)

**–î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —Å 3 –ø—Ä–æ–º–ø—Ç–∞–º–∏:**
- –í—Å–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 3 √ó (2 + 5) = 21
- V100: ~5-10 –º–∏–Ω—É—Ç
- A100: ~2-3 –º–∏–Ω—É—Ç—ã

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ùå "CUDA out of memory"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (–≤ script.sbatch –¥–æ–±–∞–≤–∏—Ç—å):
--num_inference_steps 30   # –í–º–µ—Å—Ç–æ 50

# –ò–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞):
--height 512 --width 512
```

### ‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–¥–µ–ª—å —Å–∫–∞—á–∞–Ω–∞:
ls -la models/flux_dev/

# –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—É—Ç–∏ –≤ script.sbatch:
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å, –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π
```

### ‚ùå –î–æ–ª–≥–∞—è –æ—á–µ—Ä–µ–¥—å –≤ SLURM

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ GPU —è–¥–µ—Ä:
#SBATCH --gpus=1
#SBATCH --cpus-per-task=4   # –í–º–µ—Å—Ç–æ 8

# –ò–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å V100 –≤–º–µ—Å—Ç–æ A100:
#SBATCH --constraint="type_a"
```

### ‚ùå –§–∞–π–ª prompts.json –Ω–µ –Ω–∞–π–¥–µ–Ω

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á—Ç–æ script.sbatch
ls -la prompts.json

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –≤ script.sbatch:
--prompts_file /full/path/to/prompts.json
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ SLURM –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –∑–∞–¥–∞–Ω–∏–π
squeue -u $USER

# –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞–Ω–∏–∏
scontrol show job <JOBID>

# –û—Ç–º–µ–Ω–∞ –∑–∞–¥–∞–Ω–∏—è
scancel <JOBID>

# –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
sacct -u $USER --format=JobID,JobName,State,ElapsedRaw,MaxRSS

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–∞—Ö
sinfo

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–µ—Ä–µ–¥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 1 'squeue -u $USER'
```

---

## üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ö–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É:

```bash
# –° –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã:
scp -r username@hpc.cluster:/path/to/flux_hpc/results ./
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ Python 3.10+
- [ ] –°–æ–∑–¥–∞–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `flux_env`
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`
- [ ] –ó–∞–≥—Ä—É–∂–µ–Ω–∞–Ω–∞ –º–æ–¥–µ–ª—å FLUX (`./models/flux_dev/` ~25GB)
- [ ] –°–æ–∑–¥–∞–Ω –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω `prompts.json`
- [ ] –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω `script.sbatch` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
- [ ] –ú–æ–¥–µ–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ HPC
- [ ] –ü—Ä–æ–º–ø—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ HPC
- [ ] –°–æ–∑–¥–∞–Ω—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ HPC: `bash setup_directories.sh`
- [ ] –ó–∞–¥–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ: `sbatch script.sbatch`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞: `tail -f runs/flux-*.log`
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±—Ä–∞–Ω—ã –∏–∑ `results/`

---

## üéì –ü—Ä–∏–º–µ—Ä—ã prompts.json

### –ü—Ä–∏–º–µ—Ä 1: –õ–∞–Ω–¥—à–∞—Ñ—Ç—ã

```json
{
  "mountain_sunset": {
    "text": "A serene mountain landscape during golden hour sunset",
    "hints": [
      "warm orange and pink tones, peaceful",
      "dramatic storm clouds overhead",
      "detailed rocky terrain",
      "impressionist style, soft focus",
      "minimalist composition, simple shapes"
    ]
  }
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```json
{
  "modern_building": {
    "text": "A futuristic glass skyscraper in a metropolitan city",
    "hints": [
      "clean minimalist architecture",
      "reflections in glass, blue tones",
      "daytime with clear sky",
      "night scene with neon lights",
      "wide angle perspective"
    ]
  }
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–µ—Ä—Å–æ–Ω–∞–∂–∏

```json
{
  "fantasy_character": {
    "text": "A fantasy warrior character with armor and sword",
    "hints": [
      "medieval knight armor, golden details",
      "cyberpunk armor with glowing elements",
      "detailed facial features, cinematic",
      "dynamic action pose",
      "close-up portrait style"
    ]
  }
}
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ** —Å –º–∞–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —à–∞–≥–æ–≤:
   ```bash
   python3 02_generate_images.py \
       --model_path ./models/flux_dev \
       --prompts_file ./prompts.json \
       --num_inference_steps 20
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ seed'—ã –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ metadata.json

3. **–î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–º–ø—Ç–æ–≤** —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ SLURM –∑–∞–¥–∞–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ `--seed_base`

4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å** –Ω–∞ HPC - V100 –∏–º–µ–µ—Ç 32GB VRAM, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

5. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ª–æ–≥–∏** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º:
   ```bash
   tail -f runs/flux-*.log > my_log.txt &
   ```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `cat runs/flux-JOBID.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—É—Ç—è—Ö (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç `prompts.json`: `python3 utils.py --validate-prompts prompts.json`
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –º–æ–¥–µ–ª–µ–π: `ls -la models/flux_dev/`

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [FLUX Paper](https://arxiv.org/abs/2406.16247)
- [Black Forest Labs GitHub](https://github.com/black-forest-labs/flux)
- [Diffusers Documentation](https://huggingface.co/docs/diffusers)
- [SLURM Manual](https://slurm.schedmd.com/sbatch.html)

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ**
