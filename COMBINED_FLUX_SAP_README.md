# Combined FLUX + SAP Image Generation Pipeline

–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

### –†–µ–∂–∏–º 1: Direct FLUX Generation
- –ü—Ä—è–º–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FLUX 1.dev
- –ü—Ä–æ–º—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –†–µ–∂–∏–º 2: SAP Generation (Sequential Attention Prompting)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–µ–π –ø—Ä–æ–º—Ç–æ–≤ —á–µ—Ä–µ–∑ LLM
- LLM —Ä–∞–∑–±–∏–≤–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–ø—Ä–æ–º—Ç–æ–≤
- –ö–∞–∂–¥—ã–π –ø–æ–¥–ø—Ä–æ–º—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —à–∞–≥–∞—Ö –¥–∏—Ñ—É–∑–∏–∏
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ —Ç–æ—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –†–µ–∂–∏–º 3: Both
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–æ–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
```bash
python combined_flux_sap.py --prompts-file prompts.txt --mode both
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

```bash
python combined_flux_sap.py \
  --prompts-file prompts.txt \          # –§–∞–π–ª —Å –ø—Ä–æ–º—Ç–∞–º–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)
  --output-dir results_combined \       # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  --height 1024 \                       # –í—ã—Å–æ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  --width 1024 \                        # –®–∏—Ä–∏–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  --num-inference-steps 50 \            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –¥–∏—Ñ—É–∑–∏–∏
  --guidance-scale 3.5 \                # –ú–∞—Å—à—Ç–∞–± –≥–∞–π–¥–∞–Ω—Å–∞
  --seeds 30498 40123 50456 \           # Seeds –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
  --mode both \                         # –†–µ–∂–∏–º: direct, sap, or both
  --llm GPT \                           # LLM –¥–ª—è SAP: GPT –∏–ª–∏ Zephyr
  --device cuda                         # cuda –∏–ª–∏ cpu
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

–§–∞–π–ª `prompts.txt` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–º—Ç—ã, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É:

```
A serene landscape with mountains and a crystal clear lake at sunset
A futuristic city with flying cars and neon lights
A cozy bookshop with warm lighting and wooden shelves
...
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
results_combined/
‚îú‚îÄ‚îÄ batch_YYYYMMDD_HHMMSS/
‚îÇ   ‚îú‚îÄ‚îÄ direct_flux/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompt_name_1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ direct_seed_30498.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ direct_seed_40123.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metadata.txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ sap_flux/
‚îÇ       ‚îú‚îÄ‚îÄ prompt_name_1/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ sap_seed_30498.png
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ sap_seed_40123.png
‚îÇ       ‚îú‚îÄ‚îÄ metadata.txt
‚îÇ       ‚îî‚îÄ‚îÄ ...
```

## üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPT –≤ —Ä–µ–∂–∏–º–µ SAP —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export OPENAI_API_KEY="your-api-key-here"
python combined_flux_sap.py --llm GPT
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å Zephyr (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç API):

```bash
python combined_flux_sap.py --llm Zephyr --mode sap
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–æ–ª—å–∫–æ Direct –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–±—ã—Å—Ç—Ä–æ)
```bash
python combined_flux_sap.py --mode direct --num-inference-steps 30
```

### –¢–æ–ª—å–∫–æ SAP –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–¥–µ—Ç–∞–ª—å–Ω–µ–µ)
```bash
python combined_flux_sap.py --mode sap --llm GPT
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±–æ–∏—Ö –º–µ—Ç–æ–¥–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ seeds
```bash
python combined_flux_sap.py \
  --mode both \
  --seeds 12345 67890 11111 \
  --llm GPT
```

### –° –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é Zephyr –¥–ª—è SAP
```bash
python combined_flux_sap.py \
  --mode sap \
  --llm Zephyr \
  --device cuda
```

## üìù –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–ö–∞–∂–¥–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª `metadata.txt` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (direct_flux –∏–ª–∏ sap_flux)
- –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –¥–∏—Ñ—É–∑–∏–∏
- –ó–Ω–∞—á–µ–Ω–∏–µ guidance_scale
- Seeds
- –î–ª—è SAP: –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è LLM –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
   - CUDA-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - –ú–∏–Ω–∏–º—É–º 24GB VRAM –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
   - Python 3.9+
   - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`

2. **SAP —Ä–µ–∂–∏–º —Ç—Ä–µ–±—É–µ—Ç LLM**:
   - –î–ª—è GPT –Ω—É–∂–µ–Ω API –∫–ª—é—á OpenAI
   - –î–ª—è Zephyr –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

3. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**:
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ seeds –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è Direct vs SAP
   - –†–∞–∑–Ω—ã–µ seeds –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

4. **–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**:
   - Direct: ~1-2 –º–∏–Ω—É—Ç—ã –Ω–∞ –ø—Ä–æ–º—Ç (—Å 50 —à–∞–≥–∞–º–∏)
   - SAP: +–≤—Ä–µ–º—è –Ω–∞ LLM –≤—ã–∑–æ–≤ (~1-5 —Å–µ–∫ –Ω–∞ –ø—Ä–æ–º—Ç)

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### CUDA out of memory
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–µ seeds –∏–ª–∏ –º–µ–Ω—å—à–µ resolution:
```bash
python combined_flux_sap.py --seeds 30498 --height 768 --width 768
```

### LLM timeout
–£–º–µ–Ω—å—à–∏—Ç–µ timeout –≤ –∫–æ–¥–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Zephyr –≤–º–µ—Å—Ç–æ GPT

### –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Hugging Face –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã

## üìö –°—Å—ã–ª–∫–∏

- [FLUX Documentation](https://huggingface.co/black-forest-labs/FLUX.1-dev)
- [SAP Paper](https://arxiv.org/abs/2405.05955)
- [Zephyr Model](https://huggingface.co/HuggingFaceH4/zephyr-7b-beta)

---

**–°–æ–∑–¥–∞–Ω–æ –∫–∞–∫ —á–∞—Å—Ç—å SAP (Sequential Attention Prompting) Image Generation Project**
